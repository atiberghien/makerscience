<div id="intro" class="intro-forum">
    <h1>Forum</h1>
    <h2>MakerScience</h2>
</div>

<div class="forum-search">
    <div class="row container">
        <div class="col-md-12">
            <form method="post" action="">
                <input type="search" name="forum-search" placeholder="Rechercher" />
                <button class="button button-forum">OK</button>
            </form>
        </div>
    </div><!-- .container -->
</div><!-- .forum-search -->

<div class="forum-create">
    <div class="row container">
        <div class="col-md-12" ng-init="init();showCreateButton = true">
            <button class="create-topic" ng-click="showCreateButton = !showCreateButton">Créez votre sujet ici</button>
            <form method="post" action="" collapse="showCreateButton" class="new-topic" ng-init="newPost.type='message'; initMention('iframeQuestionTextArea')" ng-controller="MentionCtrl">
                <tabset>
                    <tab select="newPost.type='message'">
                        <tab-heading ><span class="glyphicon glyphicon-comment"></span> Message</tab-heading>
                    </tab>
                    <tab select="newPost.type='question'">
                        <tab-heading><span class="glyphicon glyphicon-question-sign"></span> Question</tab-heading>
                    </tab>
                    <tab select="newPost.type='idea'">
                        <tab-heading><span class="glyphicon glyphicon-flash"></span> Idée</tab-heading>
                    </tab>
                    <tab select="newPost.type='need'">
                        <tab-heading><span class="glyphicon glyphicon-hand-up"></span> Besoin</tab-heading>
                    </tab>
                    <tab select="newPost.type='resource'">
                        <tab-heading><span class="glyphicon glyphicon-book"></span> Ressources</tab-heading>
                    </tab>
                    <tab select="newPost.type='event'">
                        <tab-heading><span class="glyphicon glyphicon-calendar"></span> Evènements</tab-heading>
                    </tab>
                </tabset>
                <input type="text" name="title" ng-model="newPost.title" placeholder="Titre de la discussion ..." class="full-width" />

                <textarea  ui-tinymce="tinyMceOptions" mentio
                    mentio-iframe-element="iframeQuestionTextArea"
                    mentio-trigger-char="'@'"
                    mentio-items="people"
                    mentio-template-url="/people-mentions.tpl"
                    mentio-typed-term="mentionTerms"
                    mentio-search="searchPeople(term)"
                    mentio-select="getPeopleTextRaw(item)"
                    mentio-id="'questionTextArea'"
                    ng-model="newPost.text"
                    ng-trim="false"
                    placeholder="Saisissez votre réponse ici."
                    rows="8">
                </textarea>

                <script type="text/ng-template" id="/people-mentions.tpl">
                    <ul class="list-group user-search">
                        <li mentio-menu-item="person" ng-repeat="person in items" class="list-group-item">
                        <ng-include src="'/views/profile/block/avatar.html'"></ng-include>
                        {{person.full_name}}
                    </ul>
                </script>

                <fieldset class="forum-keywords">
                    <div ng-controller="TagAutoCompleteCtrl">
                        <h4>Quels sont les mots-clés associés à votre projet ?</h4>
                        <tags-input ng-model="questionTags"
                                    placeholder="> Mot-clé">
                          <auto-complete source="loadTags($query)"></auto-complete>
                        </tags-input>
                    </div>
                </fieldset>

                <fieldset class="forum-linked">
                    <p>Ajouter des projets ou des expériences associés <span class="glyphicon glyphicon-link"></span></p>
                    <div class="row">
                        <div class="col-md-10">
                            <angucomplete-alt id="linked-idea"
                                            placeholder="Titre du projet ou de la ressource"
                                            pause="100"
                                            selected-object="newLinkedItem"
                                            local-data="allAvailableItems"
                                            search-fields="title"
                                            title-field="title"
                                            text-no-results="Aucun élément trouvé"
                                            minlength="3"/>
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="button" ng-click="addLinkedItem(newLinkedItem)">Lier</button>
                        </div>
                    </div>
                    <ul class="list-group">
                        <li ng-repeat="item in linkedItems">
                            <div class="row">
                                <div class="col-md-10">
                                    <label>[{{item.type}}] : {{item.fullObject.parent.title}}</label>
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-danger">
                                        <span class="glyphicon glyphicon-trash" ng-click="delLinkedItem(item)"></span></button>
                                 </div>
                            </div>
                        </li>
                    </ul>
                </fieldset>

                <fieldset class="right">
                    <button type="submit" class="button" ng-click="showCreateButton = saveMakersciencePost(newPost, null, currentMakerScienceProfile.parent)">Créer</button>
                    <button type="reset" class="button">Annuler</button>
                </fieldset>
            </form>



        </div>
    </div><!-- .container -->
</div><!-- .forum-create -->

<div class="forum-content">
    <div class="row container">
        <div class="col-md-8" >
            <div id="content" class="content-forum" >
                <tabset class="nav-tabs-forum">
                    <tab heading="Récent" select="fetchRecentPosts()"></tab>
                    <tab heading="Top" select="fetchTopPosts()"></tab>
                </tabset>
                <div ng-controller="FilterCtrl">
                    <ng-include src="'/views/base/tag_input.html'"></ng-include>
                </div>
                <div ng-repeat="post in threads">
                    <ng-include src="'/views/forum/block/thread.html'"></ng-include>
                </div>
                <pagination total-items="totalItems"
                            items-per-page='limit'
                            ng-model="currentPage"
                            max-size="10"
                            class="pagination-sm"
                            rotate="false"
                            num-pages="numPages"
                            ng-change="pageChanged(currentPage)"
                            previous-text="<<"
                            next-text=">>">
                </pagination>
            </div><!-- #content -->
        </div>
        <div class="col-md-4">
            <div class="forum-sidebar">
                <div class="forum-sidebar-dark">
                    <h3>Les membres les plus actifs</h3>
                    <ul class="forum-top-users" >
                        <li ng-repeat="contributor in bestContributors">
                            <div>
                                <a ui-sref="profile.detail({slug:contributor.slug})">
                                    <ng-include src="'/views/profile/block/avatar.html'"></ng-include>
                                    {{contributor.parent.user.first_name}} <strong>{{contributor.parent.user.last_name}}</strong>
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="forum-sidebar-light">
                    <h3>Les derniers posts sans réponses</h3>
                    <div class="post" ng-repeat="post in threads | orderBy : '-parent.posted_on' | filter : hasNoAnswer | limitTo : 2">
                        <ng-include src="'/views/forum/block/small_thread_thumb.html'" ng-init="post=post.parent"></ng-include>
                    </div><!-- .post -->
                    <!-- <p class="more"><a href="">Tout afficher</a><p> -->
                </div><!-- .forum-sidebar-light -->

                <div class="forum-sidebar-light" >
                    <h3>Suggestion de tags</h3>
                    <ul class="tags tags-padding" ng-controller="TagListCtrl">
                        <li ng-repeat="tag in tags | orderBy : '-weight' | limitTo : 25 ">
                            <a ng-if="tag.name.length > 10" tooltip="{{tag.name}}" ui-sref="tag({slug:tag.slug})">{{tag.name| characters:10}}</a>
                            <a ng-if="tag.name.length <= 10" ui-sref="tag({slug:tag.slug})">{{tag.name}}</a>
                        </li>
                        <li><a ng-show="tags.length > 25" ui-sref="tags" tooltip="Cherchez d’autres tags">Cherchez d’autres tags</a></li>
                    </ul>
                </div>

                <!-- <div class="forum-sidebar-light">
                    <form method="post" action="" class="search-by-tags">
                        <input type="search" name="search-by-tags" placeholder="Rechercher par tags..." />
                    </form>
                </div> -->

            </div>
        </div>
    </div>
</div><!-- .forum-content -->
